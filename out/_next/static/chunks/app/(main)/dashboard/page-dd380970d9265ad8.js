(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[248],{1819:function(e,t,n){"use strict";n.r(t);var r=n(9268),l=n(5349),s=n(3273),i=n(8769),o=n(3888),a=n(9727),c=n(8618),u=n(6902),d=n.n(u),f=n(7362),m=n.n(f),h=n(6006);let x=()=>{let{staffList:e,countStaffMembers:t}=(0,a.Z)(),{schedule:n}=(0,c.Z)(),[u,f]=(0,h.useState)(""),[x,p]=(0,h.useState)(""),[w,j]=(0,h.useState)([]),y=(0,h.useMemo)(()=>{let t={};return e.forEach(e=>{t[e.id]=e.name}),t},[e]),g=(0,h.useMemo)(()=>{let e=d()();return n.filter(t=>{let n=d()(t.start),r=d()(t.end);return(e.isAfter(n)||e.isSame(n))&&(e.isBefore(r)||e.isSame(r))})},[n]),b=(0,h.useMemo)(()=>{let e=d()(),t=n.filter(t=>d()(t.start).isAfter(e)).map(e=>d()(e.start));if(0===t.length)return null;let r=t[0];for(let e=1;e<t.length;e++)t[e].isBefore(r)&&(r=t[e]);return r},[n]),_=(0,h.useMemo)(()=>{if(!b)return null;let e=b.add(12,"hour"),t=n.filter(t=>d()(t.start).isSame(b)&&d()(t.end).isSame(e)).map(e=>y[e.resourceId]);return{start:b,staff:t}},[b,n,y]);function v(e){let t=e/1e3;return"".concat(Math.floor(t/3600),"h ").concat(Math.floor(t%3600/60),"m ").concat(Math.floor(t%60),"s")}return d().extend(m()),(0,h.useEffect)(()=>{let e=()=>{p(v(function(){let e=d()(),t=e.hour();return(t<7?e.clone().hour(7).minute(0).second(0):t<19?e.clone().hour(19).minute(0).second(0):e.clone().add(1,"day").hour(7).minute(0).second(0)).diff(e)}()))};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[]),(0,h.useEffect)(()=>{if(b){let e=()=>{f(v(b.diff(d()()))),_?j(_.staff):j([])};e();let t=setInterval(e,1e3);return()=>clearInterval(t)}},[b,_]),(0,r.jsx)("main",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("div",{className:"flex ml-1 flex-wrap md:flex-nowrap items-center justify-around h-full w-full gap-4 md:ml-5",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between w-full h-full gap-4",children:[(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(i.d,{children:"Staff"}),(0,r.jsx)(o.J,{className:"text-primaryText",children:t()})]})}),(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(i.d,{children:"Who's on now?"}),(0,r.jsx)(o.J,{className:"text-primaryText",children:g&&g.length>0?g.map(e=>y[e.resourceId]).join(", "):"No one is on shift"})]})}),(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(i.d,{children:"Next staffed shift starts in"}),(0,r.jsx)(o.J,{className:"text-primaryText",children:b?"".concat(u," - ").concat(w.join(", ")):"No upcoming staffed shifts"})]})}),(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(i.d,{children:"Next shift starts in"}),(0,r.jsx)(o.J,{className:"text-primaryText",children:b?x:"No upcoming shifts"})]})})]})})})};t.default=x},8618:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(5793),l=n(6902),s=n.n(l),i=n(9697),o=n.n(i),a=n(1808),c=n.n(a),u=n(6006);function d(){let e=(0,u.useRef)(-1),[t,n]=(0,r.Z)("schedule",{defaultValue:[]}),[l,i]=(0,u.useState)("");(0,u.useEffect)(()=>{!async function(){let e=await fetch("/static/models/model.essence"),t=await e.text();i(t)}()},[]);let o=async e=>await fetch("https://demos.constraintmodelling.org/server/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobid:e})}).then(e=>e.json()).then(e=>e||null).catch(e=>(console.error(e),null)),a=async e=>await fetch("https://demos.constraintmodelling.org/server/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({solver:"kissat",model:l,data:e,conjure_options:["--savilerow-options","-sat-sum-mdd","--channelling=no","-aai","--responses=2"]})}).then(e=>e.json()).then(e=>e&&e.jobid?e.jobid:null).catch(e=>(console.error(e),null)),c=async(e,t)=>{let n=new Set;e.forEach(e=>{e.skills.forEach(e=>{n.add(e)})});let r={};e.forEach((e,t)=>{r[e.id]=t+1});let l={};Array.from(n).forEach((e,t)=>{l[e]=t+1});let s={nb_nurses:e.length,nb_weeks:4,nb_skills:n.size,preferred_shift_type:{},maximum_working_days_in_a_row:{},nurse_skills:{},skills_lower_bound:{},disallowed:[]};e.forEach(e=>{let t=e.constraints.find(e=>"Preferred Shift Time"===e.label),n=(null==t?void 0:t.options[(null==t?void 0:t.selectedIndex)||0])||"Day";s.preferred_shift_type[r[e.id]]="Day"===n?1:2;let i=e.constraints.find(e=>"Maximum Working Days in a Row"===e.label);s.maximum_working_days_in_a_row[r[e.id]]=parseInt((null==i?void 0:i.options[(null==i?void 0:i.selectedIndex)||0])||"0",10),s.nurse_skills[r[e.id]]=e.skills.map(e=>l[e])}),Object.entries(t).forEach(e=>{s.skills_lower_bound[l[e[0]]]=e[1].minCount});let i=await a(JSON.stringify(s));return{jobid:i,staffEncoding:r,skillEncoding:l}},d=e=>new Promise(t=>setTimeout(t,e)),f=async t=>{e.current=t.jobid;let r=await o(t.jobid);if(!r)return null;let l=Date.now();for(;"wait"===r.status&&e.current==t.jobid;){if(Date.now()-l>=1e4)return["timeout",[]];await d(1e3),r=await o(t.jobid)}if(!r.solution)return["cancelled",[]];if(r.solution.length>0){let e=function(e,t){let n=s()(),r=1===n.weekday()&&n.isToday()?n:n.weekday(1),l=[7,0],i=[19,0],o=e.map(e=>{let n=e[0][0],s=e[0][1],o=e[1],a=r.add(s-1,"day"),c=1===o?l:i,u=a.hour(c[0]).minute(c[1]).second(0),d=u.clone().add(432e5,"millisecond");return{id:"".concat(n,"-").concat(s,"-").concat(o),resourceId:"".concat(function(e){let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];t[r]=n}return t}(t.staffEncoding)[n]),start:u.format(),end:d.format()}});return["ok",o]}(r.solution[0].assignment,t);return n(e[1]),e}return["no-solution",[]]};return{schedule:t,setSchedule:n,getSchedule:function(){return t},postSchedule:c,fetchSchedule:f}}s().extend(o()),s().extend(c())},9727:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5793),l=n(6462);function s(){let[e,t]=(0,r.Z)("staffList",{defaultValue:[]}),[n,s]=(0,r.Z)("skillList",{defaultValue:{}}),i=(r,i,o)=>{i=i.map(e=>e.toUpperCase());let a={id:(0,l.Z)(),name:r,skills:i,constraints:o};t([...e,a]),s({...n,...i.reduce((e,t)=>{var r;return{...e,[t]:{count:((null===(r=n[t])||void 0===r?void 0:r.count)||0)+1,minCount:0}}},{})})},o=n=>{let r=e.filter(e=>e.id!==n);t(r);let l=c(n,[]);s(l)},a=(n,r,l,i)=>{let o=e.map(e=>e.id===n?{id:n,name:r,skills:l,constraints:i}:e);t(o);let a=c(n,l);s(a)},c=(t,r)=>{let l=r.filter(e=>!n.hasOwnProperty(e));return l.forEach(e=>{n[e]={count:0,minCount:0}}),Object.entries(n).reduce((n,l)=>{var s,i;let[o,a]=l,c=null!==(i=null===(s=e.find(e=>e.id===t))||void 0===s?void 0:s.skills.filter(e=>e===o).length)&&void 0!==i?i:0,u=a.count-c,d=r.filter(e=>e===o).length;return{...n,...u+d>0?{[o]:{count:u+d,minCount:0}}:{}}},{})},u=(e,t)=>{n[e]?s({...n,[e]:{...n[e],minCount:t}}):console.warn('Skill "'.concat(e,'" not found in skillList.'))};return{staffList:e,skillList:n,addStaffMember:i,removeStaffMember:o,updateStaffMember:a,countStaffMembers:()=>e.length,setSkillMinCount:u}}},9200:function(e,t,n){Promise.resolve().then(n.bind(n,1819))}},function(e){e.O(0,[902,578,916,744],function(){return e(e.s=9200)}),_N_E=e.O()}]);